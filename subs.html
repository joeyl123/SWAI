<!doctype html>
<html class="no-js" lang="en">

    <head>
        <!-- meta data -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

        <!--font-family-->
		<link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
        
        <!-- title of site -->
        <title>Directory Landing Page</title>

        <!-- For favicon png -->
		<link rel="shortcut icon" type="image/icon" href="assets/logo/favicon.png"/>
       
        <!--font-awesome.min.css-->
        <link rel="stylesheet" href="assets/css/font-awesome.min.css">

        <!--linear icon css-->
		<link rel="stylesheet" href="assets/css/linearicons.css">

		<!--animate.css-->
        <link rel="stylesheet" href="assets/css/animate.css">

		<!--flaticon.css-->
        <link rel="stylesheet" href="assets/css/flaticon.css">

		<!--slick.css-->
        <link rel="stylesheet" href="assets/css/slick.css">
		<link rel="stylesheet" href="assets/css/slick-theme.css">
		
        <!--bootstrap.min.css-->
        <link rel="stylesheet" href="assets/css/bootstrap.min.css">
		
		<!-- bootsnav -->
		<link rel="stylesheet" href="assets/css/bootsnav.css" >	
        
        <!--style.css-->
        <link rel="stylesheet" href="assets/css/style.css">
        
        <!--responsive.css-->
        <link rel="stylesheet" href="assets/css/responsive.css">
        
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		
        <!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->


		<style>
			textarea.subscription-input-form {
				padding: 10px;
				border: 1px solid #ccc;
				border-radius: 5px;
				font-size: 16px;
				color: #333;
				height:unset;
			}
			</style>

    </head>
	
	<body>
		<div class="link-form">
			<form id="emailForm">
				<input type="submitEmail" id="submit-email" name="emailInput" placeholder="Enter your email" required>
			</form>
			<form id="naverForm">
				<input type="text" id="naverBlogLink" name="naverBlogLink" placeholder="Enter Naver Blog text" required>
				<button type="submit">Submit Naver Blog</button>
			</form>
			<form id="brunchForm">
				<input type="text" id="brunchBlogLink" name="brunchBlogLink" placeholder="Enter Brunch Blog text" required>
				<button type="submit">Submit Brunch Blog</button>
			</form>
			<form id="tistoryForm">
				<input type="text" id="tistoryBlogLink" name="tistoryBlogLink" placeholder="Enter Tistory Blog text" required>
				<button type="submit">Submit Tistory Blog</button>
			</form>
		</div>
		<div id="linkList" class="links-display"></div>
		<button id="finalSubmitButton">Final Submit</button>
	
		<!-- Include all js compiled plugins (below), or include individual files as needed -->
	
		<script src="assets/js/jquery.js"></script>
	
		<!-- 수업중 axios를 사용하기 위해 CDN 추가 -->
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	
		<!-- 수업중 Customize 추가 -->
		<script src="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.js"></script>
		<link href="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.css" rel="stylesheet">
	
		<!-- github를 CDN으로 활용할 수 있도록 수정 -->
		<script src="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.js"></script>
		<link href="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.css" rel="stylesheet" type="text/css" />
	
		<script type="application/javascript" src="https://jsonip.com?format=jsonp&callback=getIP"></script>
	
	
		<script>
			document.getElementById('naverForm').addEventListener('submit', function(event) {
				event.preventDefault(); // Prevent the form from refreshing the page
	
				const naverLink = document.getElementById('naverBlogLink').value;
				const linkList = document.getElementById('linkList');
	
				if (naverLink) {
					const linkElement = document.createElement('p');
					linkElement.textContent = `Naver Blog: ${naverLink}`;
					linkList.appendChild(linkElement);
				}
	
				document.getElementById('naverBlogLink').value = ''; // Clear the input field
			});
	
			document.getElementById('brunchForm').addEventListener('submit', function(event) {
				event.preventDefault(); // Prevent the form from refreshing the page
	
				const brunchLink = document.getElementById('brunchBlogLink').value;
				const linkList = document.getElementById('linkList');
	
				if (brunchLink) {
					const linkElement = document.createElement('p');
					linkElement.textContent = `Brunch Blog: ${brunchLink}`;
					linkList.appendChild(linkElement);
				}
	
				document.getElementById('brunchBlogLink').value = ''; // Clear the input field
			});
	
			document.getElementById('tistoryForm').addEventListener('submit', function(event) {
				event.preventDefault(); // Prevent the form from refreshing the page
	
				const tistoryLink = document.getElementById('tistoryBlogLink').value;
				const linkList = document.getElementById('linkList');
	
				if (tistoryLink) {
					const linkElement = document.createElement('p');
					linkElement.textContent = `Tistory Blog: ${tistoryLink}`;
					linkList.appendChild(linkElement);
				}
	
				document.getElementById('tistoryBlogLink').value = ''; // Clear the input field
			});
		</script>


		<!--footer start-->
		<footer id="footer"  class="footer">
			<div class="container">
				<div class="footer-menu">
		           	<div class="row">
			           	<div class="col-sm-3">
			           		 <div class="navbar-header">
				                <a class="navbar-brand" href="index.html">Blogs<span>inOne</span></a>
				            </div><!--/.navbar-header-->
			           	</div>
			           	<div class="col-sm-9">
			           		<ul class="footer-menu-item">
			                    <li class="scroll"><a href="#works">how it works</a></li>
			                    <li class="scroll"><a href="#explore">explore</a></li>
			                    <li class="scroll"><a href="#contact">sign up</a></li>
			                </ul><!--/.nav -->
			           	</div>
		           </div>
				</div>
				<div class="hm-footer-copyright">
					<div class="row">
						<div class="col-sm-5">
							<p>
								&copy;copyright. designed and developed by hksn.lim
							</p><!--/p-->
						</div>
						<div class="col-sm-7">
							<div class="footer-social">
								<!--socials-->
							</div>
						</div>
					</div>
					
				</div><!--/.hm-footer-copyright-->
			</div><!--/.container-->

			<div id="scroll-Top">
				<div class="return-to-top">
					<i class="fa fa-angle-up " id="scroll-top" data-toggle="tooltip" data-placement="top" title="" data-original-title="Back to Top" aria-hidden="true"></i>
				</div>
				
			</div><!--/.scroll-Top-->
			
        </footer><!--/.footer-->
		<!--footer end-->
		
		<!-- Include all js compiled plugins (below), or include individual files as needed -->

		<script src="assets/js/jquery.js"></script>
        
        <!--modernizr.min.js-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
		
		<!--bootstrap.min.js-->
        <script src="assets/js/bootstrap.min.js"></script>
		
		<!-- bootsnav js -->
		<script src="assets/js/bootsnav.js"></script>

        <!--feather.min.js-->
        <script  src="assets/js/feather.min.js"></script>

        <!-- counter js -->
		<script src="assets/js/jquery.counterup.min.js"></script>
		<script src="assets/js/waypoints.min.js"></script>

        <!--slick.min.js-->
        <script src="assets/js/slick.min.js"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
		     
        <!--Custom JS-->
        <script src="assets/js/custom.js"></script>

		<!-- 수업중 axios를 사용하기 위해 CDN 추가 -->
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

		<!-- 수업중 Customize 추가 -->
		<script src="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.js"></script>
		<link href="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.css" rel="stylesheet">
	
		<!-- github를 CDN으로 활용할 수 있도록 수정 -->
		<script src="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.js"></script>
		<link href="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.css" rel="stylesheet" type="text/css" />
			
        

		<script type="application/javascript">
			var ip = "null";
			function getIP(json) {
				console.log(json);
				try {
					ip = json.ip;
				} catch (e) {
					ip = 'unknown';
				}
				return;
			}
		</script>
		<script type="application/javascript" src="https://jsonip.com?format=jsonp&callback=getIP"></script>

		<script>
					
					// 쿠키에서 값을 가져오는 함수
					function getCookieValue(name) {
						const value = "; " + document.cookie;
						const parts = value.split("; " + name + "=");
						if (parts.length === 2) {
							return parts.pop().split(";").shift();
						}
					}

					// 쿠키에 값을 저장하는 함수
					function setCookieValue(name, value, days) {
						let expires = "";
						if (days) {
							const date = new Date();
							date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
							expires = "; expires=" + date.toUTCString();
						}
						document.cookie = name + "=" + (value || "") + expires + "; path=/";
					}

					function getUVfromCookie() {
						// 6자리 임의의 문자열 생성
						const hash = Math.random().toString(36).substring(2, 8).toUpperCase();
						// 쿠키에서 기존 해시 값을 가져옴
						const existingHash = getCookieValue("user");
						// 기존 해시 값이 없으면, 새로운 해시 값을 쿠키에 저장
						if (!existingHash) {
							setCookieValue("user", hash, 180); // 쿠키 만료일은 6개월 
							return hash;
						} else {
							// 기존 해시 값이 있으면, 기존 값을 반환
							return existingHash;
						}
					}

					
					// Sam pading value to start with 0. eg: 01, 02, .. 09, 10, ..
					function padValue(value) {
						return (value < 10) ? "0" + value : value;
					}

					function getTimeStamp() {
						const date = new Date();

						const year = date.getFullYear();
						const month = date.getMonth() + 1;
						const day = date.getDate();
						const hours = date.getHours();
						const minutes = date.getMinutes();
						const seconds = date.getSeconds();

						const formattedDate = `${padValue(year)}-${padValue(month)}-${padValue(day)} ${padValue(hours)}:${padValue(minutes)}:${padValue(seconds)}`;

						return formattedDate;
					}
					
					var queryString = location.search;
					const urlParams = new URLSearchParams(queryString);
					const utm = urlParams.get("utm")

					var mobile = 'desktop';
					if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
						// true for mobile device
						mobile = 'mobile';
					}
				
					/* data를 만들 땐 모든 field가 들어 있어야 함 */
					var data = JSON.stringify(
									{"id": getUVfromCookie(),
								"landingUrl":window.location.href, 
								"ip":ip, 
								"referer":document.referrer,
								"time_stamp":getTimeStamp(), 
								"utm":utm,
								"device":mobile}
								);

					

					$(document).ready(function () {

						addrScript = 'https://script.google.com/macros/s/AKfycbzU03SlBcTqnc8lI48NwDyaH8-mMR5Twm5TQM4RAdrX9vWxtkKTX1JTwcHppvRR22zJ/exec';

						$.ajax({
							url: addrScript+'?action=insert&table=visitors&data='+data,
							dataType: 'jsonp',
							success: function (data) {
							console.log('성공 - ', JSON.stringify(data));
							},
							error: function (xhr) {
							console.log('실패 - ', JSON.stringify(xhr));
							}
						});
						});


						axios.get('https://script.google.com/macros/s/AKfycbzU03SlBcTqnc8lI48NwDyaH8-mMR5Twm5TQM4RAdrX9vWxtkKTX1JTwcHppvRR22zJ/exec?action=insert&table=tab_master&data='+data)
                    				.then(response => {
                        			console.log(JSON.stringify(response));
                    			});

							
					$("#finalSubmitButton").on("click", function () {
						const email = $("#submit-email").val();
						const subscriptions = $("#linkList").val();
				
						function validateEmail(email) {
							var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
							return re.test(email);
						}
				
						if (email == '' || !validateEmail(email)) {
							alert("이메일이 유효하지 않아 알림을 드릴 수가 없습니다. ");
							return;
						}
				
						var finalData = JSON.stringify({
							"id": getUVfromCookie(),
							"email": email,
							"subscriptionslist": subscriptions
						})

						$.busyLoadFull("show");

						axios.get('https://script.google.com/macros/s/AKfycbzU03SlBcTqnc8lI48NwDyaH8-mMR5Twm5TQM4RAdrX9vWxtkKTX1JTwcHppvRR22zJ/exec?action=insert&table=subscriptions&data=' + finalData)
							.then(response => {
							console.log(response.data.data);
							$('#submit-email').val('');
							$('#linkList').val('');
							$.fn.simplePopup({ type: "html", htmlSelector: "#popup" });
							$.busyLoadFull("hide");
							})
					});
		</script>

	<div id="popup" style="display:none;">
	<h1>감사합니다. </h1>
	<p>이제는 우리는 같은 배를 탔습니다.  </p>
    </div>

	</body>
</html>